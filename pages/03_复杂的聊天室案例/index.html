<!DOCTYPE html>
<html lang="zh">

<head>
  <meta charset="UTF-8">
  <title>聊天室</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }

    #chat {
      max-width: 600px;
      margin: auto;
    }

    #messages {
      border: 1px solid #ccc;
      height: 400px;
      overflow-y: scroll;
      padding: 10px;
    }

    .message {
      margin: 5px 0;
    }

    .my-message {
      text-align: right;
    }

    .other-message {
      text-align: left;
    }
  </style>
</head>

<body>
  <div id="chat">
    <input type="text" id="username" placeholder="输入用户名" />
    <button id="joinBtn">进入聊天室</button>
    <div id="messages"></div>
    <input type="text" id="messageInput" placeholder="输入消息" />
    <button id="sendBtn">发送</button>
  </div>

  <script>
    let ws;
    let username;

    document.getElementById('joinBtn').addEventListener('click', () => {
      username = document.getElementById('username').value;
      if (!username) return alert('请先输入用户名');

      ws = new WebSocket('ws://localhost:3000');

      ws.onopen = () => {
        console.log('连接成功');
      };

      ws.onmessage = (event) => {
        // console.log(event)
        // return
        const { user, time, message } = JSON.parse(event.data);
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', user === username ? 'my-message' : 'other-message');
        messageDiv.innerText = `${user} [${time}]: ${message}`;
        document.getElementById('messages').appendChild(messageDiv);
      };
    });

    document.getElementById('sendBtn').addEventListener('click', () => {
      const message = document.getElementById('messageInput').value;
      if (message) {
        const timestamp = new Date().toLocaleTimeString();
        ws.send(JSON.stringify({ user: username, time: timestamp, message }));
        document.getElementById('messageInput').value = '';
      }
    });
  </script>
</body>

</html>